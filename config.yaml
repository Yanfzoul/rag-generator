# ----- PATHS -----
paths:
  data_root: ./data
  index_root: ./store

# ----- INDEX -----
index:
  name: rag   # logical name for this index; used as filename prefix

# ----- SOURCES (generic) -----
# Define the local inputs for your RAG. Each entry describes a directory
# with include/exclude globs and how to treat its content.
sources:
  - name: CodeRepo
    type: repo
    path: ./data/repo
    include: ["**/*"]
    exclude: ["**/*.png","**/*.jpg","**/*.pdf","**/*.zip","**/*.7z"]
    treat_as: auto
    chunking:
      code_max_lines: 100
      overlap_lines: 10
      tokenizer_cap: 700
  - name: Tutorials
    type: tutorials
    path: ./data/tutorials_txt
    include: ["**/*.md","**/*.html","**/*.txt"]
    treat_as: prose
    chunking:
      prose_max_chars: 1400
      min_chunk_chars: 200
      tokenizer_cap: 650
  - name: Docs
    type: docs
    path: ./data/docs_txt
    include: ["**/*.txt"]
    treat_as: prose
    chunking:
      prose_max_chars: 1200
      min_chunk_chars: 250
      tokenizer_cap: 650
  - name: ExternalDocs
    type: docs
    path: ./data/documents_txt
    include: ["**/*.txt"]
    treat_as: prose
    chunking:
      prose_max_chars: 1200
      min_chunk_chars: 250
      tokenizer_cap: 650

# ----- INDEXING -----
indexing:
  code_max_lines: 100
  prose_max_chars: 1600
  min_chunk_chars: 300
  overlap_lines: 10

# Tokenizer used for counting/trimming; safe default aligns with small code model
tokenizer_model_id: "stabilityai/stable-code-instruct-3b"
model_id: "stabilityai/stable-code-instruct-3b"

# ----- EMBEDDING / RERANK -----
embedding:
  model: "BAAI/bge-base-en-v1.5"
  batch_size: 64
  normalize_embeddings: true

reranker:
  enabled: true
  model: "BAAI/bge-reranker-base"
  top_k: 10
  final_k: 3

# ----- RETRIEVAL -----
retrieval:
  initial_k: 24
  include_metadata: [repo, path, start_line, end_line, url, source_type]
  bm25:
    enabled: true
  fusion_weights:
    semantic: 0.55
    lexical: 0.35
    identifier: 0.10
  symbol_prefixes: ["API_","CFG_"]
  source_weights: { repo: 1.0, docs: 1.0, tutorials: 0.95, external: 0.95 }

# ----- PROMPT / GENERATION -----
prompt:
  max_input_tokens: 3800
  context_separator: "\n---\n"
  system_message: |
    You are a concise domain expert. Prefer minimal, executable examples when code is requested.
    Ground every statement in the provided CONTEXT only.
    If something is uncertain or missing in CONTEXT, say so and suggest what to check.
  template: |
    SYSTEM:
    {system_message}

    QUESTION:
    {question}

    CONTEXT (CITED EXCERPTS):
    {context}

    INSTRUCTIONS:
    - Use only the information in CONTEXT.
    - Cite sources inline like [type:label:start-end] or [type:label].
    - Provide a minimal compilable snippet when code is requested.
    - If anything may be outdated (external), warn once: "(external, may be outdated)".

    ANSWER:

generation:
  model_id: "stabilityai/stable-code-instruct-3b"

# ----- SYMBOLS (optional, for identifier boosts) -----
symbols:
  base_dirs: []
  header_globs: ["**/*.h", "**/*.hpp"]

# ----- OPTIONAL: Fetch/Crawl tasks (enable for a full web-first build) -----
fetch:
  - type: github
    repo: https://github.com/org/repo
    dest: ./data/repo
    depth: 1
  - type: http_list
    urls:
      - https://example.com/docs/page1
      - https://example.com/docs/page2
    dest_dir: ./data/tutorials

crawl:
  - seeds:
      - https://example.com/docs
      - https://example.com/blog
    allow_domains: ["example.com"]
    depth: 2
    per_domain_limit: 200
    out_dir: ./data/crawl

# Optional: Normalize and convert tasks to avoid CLI arguments
normalize:
  - src: ./data/tutorials
    dst: ./data/tutorials_txt
  - src: ./data/crawl
    dst: ./data/crawl_txt

convert_docs:
  - src: ./data/docs
    dst: ./data/docs_txt
    glob: ["**/*.pdf","**/*.doc","**/*.docx","**/*.ppt","**/*.pptx","**/*.xls","**/*.xlsx","**/*.odt","**/*.ods","**/*.odp","**/*.rtf","**/*.png","**/*.jpg","**/*.jpeg","**/*.gif","**/*.bmp","**/*.tiff"]
    enable_ocr: true
    use_tesseract: true
    ocr_image_conf_threshold: 0.6
  - src: ../../documents
    dst: ./data/documents_txt
    glob: ["**/*.pdf","**/*.doc","**/*.docx","**/*.ppt","**/*.pptx","**/*.xls","**/*.xlsx","**/*.odt","**/*.ods","**/*.odp","**/*.rtf","**/*.png","**/*.jpg","**/*.jpeg","**/*.gif","**/*.bmp","**/*.tiff"]
    enable_ocr: true
    use_tesseract: true
    ocr_image_conf_threshold: 0.6
