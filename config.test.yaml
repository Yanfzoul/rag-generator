# Test configuration for fast local runs

# ----- PATHS -----
paths:
  data_root: ./data
  index_root: ./store

# ----- INDEX -----
index:
  name: test

# ----- SOURCES -----
sources:
  - name: CodeRepo
    type: repo
    path: ./data/repo
    include: ["**/*"]
    exclude: ["**/*.png","**/*.jpg","**/*.pdf","**/*.zip","**/*.7z"]
    treat_as: auto
    chunking:
      code_max_lines: 80
      overlap_lines: 8
      tokenizer_cap: 650
  - name: Docs
    type: docs
    path: ./data/docs_txt
    include: ["**/*.txt"]
    treat_as: prose
    chunking:
      prose_max_chars: 1200
      min_chunk_chars: 200
      tokenizer_cap: 650
  - name: ExternalDocs
    type: docs
    path: ./data/documents_txt
    include: ["**/*.txt"]
    treat_as: prose
    chunking:
      prose_max_chars: 1200
      min_chunk_chars: 200
      tokenizer_cap: 650

# ----- INDEXING -----
indexing:
  code_max_lines: 80
  prose_max_chars: 1200
  min_chunk_chars: 200
  overlap_lines: 8

# Tokenizer used for counting/trimming; safe default aligns with small code model
tokenizer_model_id: "stabilityai/stable-code-instruct-3b"
model_id: "stabilityai/stable-code-instruct-3b"

# ----- EMBEDDING / RERANK -----
embedding:
  model: "sentence-transformers/all-MiniLM-L6-v2"
  batch_size: 32
  normalize_embeddings: true

reranker:
  enabled: true
  model: "BAAI/bge-reranker-base"
  top_k: 8
  final_k: 3

# ----- RETRIEVAL -----
retrieval:
  initial_k: 16
  include_metadata: [repo, path, start_line, end_line, url, source_type]
  bm25:
    enabled: false
  fusion_weights:
    semantic: 0.55
    lexical: 0.35
    identifier: 0.10
  symbol_prefixes: ["API_","CFG_"]
  source_weights: { repo: 1.0, docs: 1.0, external: 0.95 }

# ----- PROMPT / GENERATION -----
prompt:
  max_input_tokens: 3200
  context_separator: "\n---\n"
  system_message: |
    You are a concise domain expert. Use only the provided CONTEXT.
  template: |
    SYSTEM:
    {system_message}

    QUESTION:
    {question}

    CONTEXT (CITED EXCERPTS):
    {context}

    ANSWER:

generation:
  model_id: "stabilityai/stable-code-instruct-3b"

# ----- SYMBOLS (optional, for identifier boosts) -----
symbols:
  base_dirs: []
  header_globs: ["**/*.h", "**/*.hpp"]

# ----- OPTIONAL: Fetch/Crawl tasks (enable for a full web-first build) -----
fetch:
  - type: github
    repo: https://github.com/org/repo
    dest: ./data/repo
    depth: 1

crawl:
  - seeds:
      - https://example.com/docs
    allow_domains: ["example.com"]
    depth: 1
    per_domain_limit: 50
    out_dir: ./data/crawl

# Optional: Normalize and convert tasks to avoid CLI arguments
normalize:
  - src: ./data/crawl
    dst: ./data/crawl_txt

convert_docs:
  - src: ./data/docs
    dst: ./data/docs_txt
    glob: ["**/*.pdf","**/*.doc","**/*.docx","**/*.ppt","**/*.pptx","**/*.xls","**/*.xlsx","**/*.odt","**/*.ods","**/*.odp","**/*.rtf","**/*.png","**/*.jpg","**/*.jpeg","**/*.gif","**/*.bmp","**/*.tiff"]
    enable_ocr: true
    use_tesseract: true
    ocr_image_conf_threshold: 0.6
